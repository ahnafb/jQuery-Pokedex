<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokedex by Ahnaf</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script>
        let currentPage = 1;

        function showModal(pokemonName, pokemonImage) {
            $.ajax({
                type: "GET",
                url: `https://pokeapi.co/api/v2/pokemon/${pokemonName}`,
                success: function(response) {
                    let abilities = response.abilities.map(ability => ability.ability.name).join(', ');
                    let types = response.types.map(type => type.type.name).join(', ');

                    $("#modal-content").html(`
                        <span class="close" onclick="closeModal()">&times;</span>
                        <h2>${pokemonName}</h2>
                        <img src="${pokemonImage}" alt="${pokemonName}" />
                        <p><strong>Abilities:</strong> ${abilities}</p>
                        <p><strong>Types:</strong> ${types}</p>
                    `);

                    $(".modal").css("display", "block");
                },
                error: function(error) {
                    console.log('Error:', error);
                }
            });
        }

        function closeModal() {
            $(".modal").css("display", "none");
        }

        function listPokedexAhnaf(page) {
            let url = `https://pokeapi.co/api/v2/pokemon?offset=${(page - 1) * 20}&limit=20`;
            $.ajax({
                type: "GET",
                url: url,
                success: function (response) {
                    let results = response.results;

                    $(".box-list").empty();
                    for (let i = 0; i < results.length; i++) {
                        let pokeName = results[i].name;
                        let pokeImage = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${(page - 1) * 20 + i + 1}.png`;

                        let temp_html = `
                            <div class="image-card" onclick="showModal('${pokeName}', '${pokeImage}')">
                                <a>
                                    <img src="${pokeImage}" alt="${pokeName}" />
                                    <div class="card-text">
                                        <p>${pokeName}</p>
                                    </div>
                                </a>
                            </div>
                        `;

                        $(".box-list").append(temp_html);
                    }

                    let totalPages = Math.ceil(response.count / 20);
                    updatePagination(totalPages);
                },
                error: function (error) {
                    console.log('Error:', error);
                }
            });
        }

        function updatePagination(totalPages) {
            $("#pagination").empty();
            for (let i = 1; i <= totalPages; i++) {
                let listItem;
                if (i === currentPage || i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    listItem = `<li onclick="changePage(${i})" class="${i === currentPage ? 'active' : ''}">${i}</li>`;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    listItem = `<li class="ellipsis">...</li>`;
                }
                $("#pagination").append(listItem);
            }
        }

        function changePage(page) {
            currentPage = page;
            listPokedexAhnaf(page);
        }

        function searchPokemon() {
            let input = document.getElementById('searchInput').value.toLowerCase();
            let cards = document.getElementsByClassName('image-card');

            for (let i = 0; i < cards.length; i++) {
                let pokemonName = cards[i].getElementsByTagName('p')[0].innerText.toLowerCase();
                if (pokemonName.indexOf(input) > -1) {
                    cards[i].style.display = '';
                } else {
                    cards[i].style.display = 'none';
                }
            }
        }

        $(document).ready(function () {
            listPokedexAhnaf(currentPage);
        });
    </script>
</head>
<body>
    <header>
        <div class="head">
            <h1>Pok√©dex by Ahnaf</h1>
            <input type="text" class="search-bar" id="searchInput" placeholder="Search Pokemon..." onkeyup="searchPokemon()">
        </div>
    </header>

    <div class="box-list"></div>

    <ul id="pokemonList"></ul> <!-- Tambahkan elemen ini -->

    <div id="pagination-container">
        <ul id="pagination"></ul>
    </div>

    <div class="modal">
        <div class="modal-content" id="modal-content"></div>
    </div>
</body>
</html>
